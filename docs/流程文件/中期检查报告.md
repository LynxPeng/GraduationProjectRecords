# 中期检查报告 

##### **开题时的进度计划**

- [x] 2025年1月1日至1月7日 	学习Rust异步编程基础
- [x] 2025年1月7日至1月21日 	学习ReL4和seL4的相关论文、背景知识和熟悉相关代码。
- [x] 2025年1月22日至2月4日 	学习TAIC硬件设计及使用，熟悉相关代码。
- [ ] ~~2025年2月5日至2月25日 	完成TAIC到ReL4的适配方案设计~~
- [x] 2025 年2月26日至3月12日	修改Rel4 内核中的异步运行时，适配taic 
- [x] 2025 年3月12日至3月19日	修改系统调用测试函数，跑通异步系统调用测试
- [ ] 2025 年3月19日至3月26日	分析 taic 对 rel4 的性能提升

## 一、毕业设计（论文）主要研究内容、进展情况及取得成果

1. **已学习Rust异步编程，成功复现rel4项目和taic硬件使用**。

学习了Rel4目前基于用户态中断和硬件调度的异步进程间通信，学习目前用户态异步运行时的实现。

2. **基于复现成果，改写了rel4内核中的异步运行时，实现了兼容TAIC硬件调度器的异步系统调用。**

主要修改异步运行时中的就绪队列和协程唤醒逻辑；基于taic_driver实现用于内核访问taic的接口，将原有的就绪队列更改为硬件中的队列，并调整协程id的分配，修改原异步系统调用处理协程的生成和实现。

3. **基于内核的异步运行时修改原有的异步系统调用测试。**

主要修改缓冲区的注册，通知的注册，异步库中的部分函数。

4. **在实现过程中，遇到的主要问题是硬件中阻塞队列的缓存数量存在限制、多次注册导致性能开销过大。**

针对缓存数量限制问题，设计了一种利用软件复用硬件通道的解决方案。

协程的唤醒需要使用一个中断向量，硬件调度器的中断向量数量有限，只有32个。因此用户态程序需要记录中断向量的使用情况，以分配中断向量给不同的协程。中断向量表中常驻一个0号协程(dispatcher协程)。客户端执行异步IPC的协程在发送通知前需要先申请一个中断向量。如果此时中断向量表未满时，则该协程会拿到一个中断向量，并将该中断向量写入IPCItem中传递给服务端。服务端收到异步IPC后，根据IPCItem中的中断向量唤醒阻塞的客户端协程。如果此时中断向量表已满，则该协程申请不到中断向量，则将IPCItem中的向量置0。服务端收到异步IPC后，如果IPCItem中的中断向量为0，则唤醒0号dispatcher协程。dispatcher协程根据IPCItem中的cid，唤醒对应的协程。

这种更改会带来新的问题，多次注册

## 二、存在的问题和拟解决方案

1. 内核中的处理协程若阻塞，只能等待时钟中断后被唤醒执行，延迟较高。

## 三、下一步研究任务与进度安排

1. 基于异步进程间通信实现一个支持异步的用户态文件系统。



